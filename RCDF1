
#1
library(rcdf)
library(dplyr)

env <- read_env()

password <- env$PRIVATE_KEY_PW

decryption_key <- "data/sample-rcdf/RSA Keys/1001319-private-key.pem"

data <- read_rcdf(
  path = "data/sample-rcdf/1001319 Sumilao.rcdf",
  decryption_key = decryption_key,
  password = password,
  return_meta = TRUE
)

attributes(data)
class(data)
names(data)
glimpse(data)
View(data)



#2

path <- "data/sample-rcdf/1001319 Sumilao.rcdf"

source_note <- get_rcdf_metadata(path, key = "source_note")
psgc_version <- get_rcdf_metadata(path, key = "psgc_version")
#area_names <- get_rcdf_metadata(path, key = "area_names")
summary_statistics <- get_rcdf_metadata(path, key = "summary_statistics")
ignore_duplicates <- get_rcdf_metadata(path, key = "ignore_duplicates")
key_app <- get_rcdf_metadata(path, key = "key_app")
iv_app <- get_rcdf_metadata(path, key = "iv_app")
key_admin <- get_rcdf_metadata(path, key = "key_admin")
iv_admin <- get_rcdf_metadata(path, key = "iv_admin")
pc_os <- get_rcdf_metadata(path, key = "pc_os")
pc_os_release_date <- get_rcdf_metadata(path, key = "pc_os_release_date")
pc_os_version <- get_rcdf_metadata(path, key = "pc_os_version")
pc_hardware <- get_rcdf_metadata(path, key = "pc_hardware")
version <- get_rcdf_metadata(path, key = "version")
checksum <- get_rcdf_metadata(path, key = "checksum")
dir_base <- get_rcdf_metadata(path, key = "dir_base")

paste("Source Note:", source_note)
paste("PSGC Version:", psgc_version)
#paste("Area Names:", area_names)
paste("Summary Statistics:", summary_statistics)
paste("Ignore Duplicates:", ignore_duplicates)
paste("Key App:", key_app)
paste("IV App:", iv_app)
paste("Key Admin:", key_admin)
paste("IV Admin:", iv_admin)
paste("PC OS:", pc_os)
paste("PS OS Release Date:", pc_os_release_date)
paste("PC OS Version:", pc_os_version)
paste("PC Hardware:", pc_hardware)
paste("Version:", version)
paste("Checksum:", checksum)
paste("DIR Base:", dir_base)


#3
data_dictionary <- get_rcdf_metadata(
  path = path,
  key = "dictionary"
)

glimpse(data_dictionary)
View(data_dictionary)




#4
library(stringr)

data_dictionary_filtered <- data_dictionary %>%
  filter(str_detect(variable_name,"^(a01|a03|e)"))

glimpse(data_dictionary_filtered)
View(data_dictionary_filtered)

#5
data_dictionary_filtered <- data_dictionary %>%
  filter(type %in% c("c","i"))

glimpse(data_dictionary_filtered)
View(data_dictionary_filtered)



#6
relation_to_hh_head <- data_dictionary[
  data_dictionary$variable_name == "a02_relation_to_hh_head",
]$valueset[[1]]


glimpse(relation_to_hh_head)
View(relation_to_hh_head)
